<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Odontoprev - Sistema CRUD</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet"/>
  <link href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css" rel="stylesheet"/>
  <style>
    body { padding: 2rem; background: linear-gradient(135deg, #e3f0ff 0%, #b0cfff 100%); min-height: 100vh; }
    .container { max-width: 1400px; margin: 0 auto; display: flex; flex-direction: column; align-items: center; }
    .card { margin-bottom: 2.5rem; box-shadow: 0 2px 16px rgba(25, 118, 210, 0.10); border-radius: 18px; border: none; background: #fff; width: 100%; max-width: 1200px; }
    .card-body { display: flex; flex-direction: column; align-items: center; width: 100%; padding: 2.5rem 2rem; box-sizing: border-box; }
    .card-title { font-weight: 700; color: #1565c0; letter-spacing: 0.5px; text-align: center; }
    form { width: 100%; max-width: 1000px; margin: 0 auto; padding: 1.2rem 0.5rem; box-sizing: border-box; }
    .json-output, .json-output-table { width: 100%; max-width: 100%; margin: 0 auto; }
    .json-output { background: #e3f2fd; padding: 1.2rem; border-radius: 14px; border: 1.5px solid #90caf9; font-size: 1rem; color: #0d47a1; }
    .tabela-scroll-wrapper {
      width: 100%;
      margin-bottom: 1rem;
      border-radius: 10px;
    }
    .json-output-table {
      width: 100% !important;
      background: #f4faff;
      border-radius: 10px;
      border: 1.5px solid #90caf9;
      margin: 0;
    }
    .dataTables_wrapper {
      width: 100%;
      overflow-x: auto;
      padding: 1rem 0;
    }
    /* Estilos para garantir que as colunas mantenham suas larguras */
    .json-output-table th,
    .json-output-table td {
      min-width: 120px; /* Largura base para todas as colunas */
    }
    /* Larguras específicas para diferentes tipos de colunas */
    .json-output-table th:first-child,
    .json-output-table td:first-child {
      min-width: 80px; /* Colunas de ID */
    }
    .json-output-table th:nth-child(2),
    .json-output-table td:nth-child(2) {
      min-width: 200px; /* Colunas de nome/título */
    }
    .json-output-table th:last-child,
    .json-output-table td:last-child {
      min-width: 150px; /* Coluna de ações */
      width: 150px;
    }
    .json-output-table.dtr-inline.collapsed>tbody>tr>td.dtr-control:before,
    .json-output-table.dtr-inline.collapsed>tbody>tr>th.dtr-control:before {
      background-color: #1976d2;
    }
    .modal-dialog {
      max-width: 90%;
      margin: 1.75rem auto;
    }
    @media (max-width: 768px) {
      .modal-dialog {
        max-width: 95%;
        margin: 1rem auto;
      }
    }
    .json-output-table th, 
    .json-output-table td {
      padding: 0.8rem 1rem;
      text-align: left !important;
      vertical-align: middle;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .json-output-table th {
      background: #1976d2;
      color: #fff;
      font-weight: 600;
      border-bottom: 2px solid #90caf9;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .json-output-table tr {
      border-bottom: 1px solid #bbdefb;
    }
    .json-output-table tbody tr:hover {
      background-color: #f5f9ff;
    }
    .json-output-table td {
      background: #e3f0ff;
      max-width: 300px; /* Limita o tamanho máximo da célula */
    }
    .json-output-table td:last-child {
      white-space: nowrap;
      background: #e3f0ff;
    }
    /* Estilo para células com conteúdo longo */
    .json-output-table td.long-content {
      cursor: pointer;
    }
    .json-output-table td.long-content:hover {
      color: #1976d2;
    }
    .paciente-actions, .acoes-tabela { display: flex; gap: 0.5rem; justify-content: center; align-items: center; }
    .btn-sm { font-size: 0.95rem; border-radius: 7px; padding: 0.35rem 1.1rem; }
    .btn-primary { background: #1976d2; border: none; }
    .btn-primary:hover { background: #1565c0; }
    .btn-danger { background: #e53935; border: none; }
    .btn-danger:hover { background: #b71c1c; }
    @media (max-width: 1000px) {
      .container, .card, .json-output, .json-output-table { max-width: 100vw; }
      form { max-width: 98vw; }
    }
    @media (max-width: 900px) {
      .card-body { padding: 1.2rem 0.5rem; }
      form { max-width: 100vw; }
      .json-output, .json-output-table { max-width: 100vw; }
      .json-output-table th, .json-output-table td { padding: 0.5rem 0.3rem; font-size: 0.98rem; }
    }
    @media (max-width: 600px) {
      .card { border-radius: 0; }
      .card-body { padding: 0.5rem 0.1rem; }
      form { padding: 0.5rem 0.1rem; }
      .json-output, .json-output-table { padding: 0.5rem 0.1rem; }
      .json-output-table th, .json-output-table td { padding: 0.3rem 0.1rem; font-size: 0.93rem; }
    }
  </style>
</head>
<body>
<div class="container">
  <h1 class="text-primary mb-4 text-center">Sistema Odontoprev - Gerenciamento de Dados</h1>

  <!-- Reutilizável: cardForm(id, titulo, formHTML, outputId) -->
  <!-- Pacientes -->
  <div class="card"><div class="card-body">
    <h3 class="card-title">Cadastrar Paciente</h3>
    <form id="formPaciente">
      <input type="hidden" />
      <div class="row g-2 mb-2">
        <div class="col"><input class="form-control" id="nome" placeholder="Nome"/></div>
        <div class="col"><input class="form-control" id="idade" placeholder="Idade" type="number"/></div>
        <div class="col"><select class="form-select" id="sexo">
          <option value="F">Feminino</option><option value="M">Masculino</option><option value="N">Não Binário</option></select></div>
        <div class="col"><select class="form-select" id="plano">
          <option>Básico</option><option>Intermediário</option><option>Premium</option></select></div>
      </div>
      <div class="row g-2 mb-2">
        <div class="col"><input class="form-control" id="cidade" placeholder="Cidade"/></div>
        <div class="col"><input class="form-control" id="estado" placeholder="Estado"/></div>
        <div class="col"><select class="form-select" id="possui_trat_preventivo">
          <option value="true">Possui Trat. Preventivo</option>
          <option value="false">Não Possui Trat. Preventivo</option></select></div>
        <div class="col"><select class="form-select" id="possui_trat_curativo">
          <option value="true">Possui Trat. Curativo</option>
          <option value="false">Não Possui Trat. Curativo</option></select></div>
        <div class="col"><input class="form-control" id="score_risco" placeholder="Score de Risco" type="number" step="0.01"/></div>
      </div>
      <div class="row g-2">
        <div class="col"><button class="btn btn-success w-100" type="submit">Salvar</button></div>
      </div>
    </form>
    <div id="outputPacientes" class="json-output mt-3">Carregando...</div>
    <div class="tabela-scroll-wrapper">
      <table class="json-output-table mt-3" id="tabelaPacientes" style="display:none;">
        
      </table>
    </div>
  </div></div>

  <!-- Consultas -->
  <div class="card"><div class="card-body">
    <h3 class="card-title">Cadastrar Consulta</h3>
    <form id="formConsulta">
      <div class="row g-2 mb-2">
        <div class="col"><input class="form-control" id="pacienteConsulta" placeholder="ID do Paciente"/></div>
        <div class="col"><input class="form-control" id="dentistaId" placeholder="Dentista"/></div>
        <div class="col"><input class="form-control" id="especialidade" placeholder="Especialidade"/></div>
        <div class="col"><input class="form-control" id="dataConsulta" type="date"/></div>
        <div class="col"><select class="form-select" id="tipoConsulta">
          <option value="curativa">Curativa</option>
          <option value="preventiva">Preventiva</option>
        </select></div>
      </div>
      <div class="row g-2 mb-2">
        <div class="col"><input class="form-control" id="observacoes" placeholder="Observações"/></div>
        <div class="col"><select class="form-select" id="realizada">
          <option value="false">Não Realizada</option>
          <option value="true">Realizada</option>
        </select></div>
        <div class="col"><button class="btn btn-success w-100" type="submit">Salvar</button></div>
      </div>
    </form>
    <div id="outputConsultas" class="json-output mt-3">Carregando...</div>
    <div class="tabela-scroll-wrapper">
      <table class="json-output-table mt-3" id="tabelaConsultas" style="display:none;">
        
      </table>
    </div>
  </div></div>

  <!-- Tratamentos -->
  <div class="card"><div class="card-body">
    <h3 class="card-title">Cadastrar Tratamento</h3>
    <form id="formTratamento">
      <div class="row g-2 mb-2">
        <div class="col"><input class="form-control" id="pacienteTratamento" placeholder="ID Paciente"/></div>
        <div class="col"><input class="form-control" id="tipoTratamento" placeholder="Tipo de Tratamento"/></div>
        <div class="col"><input class="form-control" id="profissional_responsavel" placeholder="Profissional Responsável"/></div>
      </div>
      <div class="row g-2 mb-2">
        <div class="col"><input class="form-control" id="dataTratamento" type="date" placeholder="Data de Início"/></div>
        <div class="col"><input class="form-control" id="custoEstimado" type="number" placeholder="Custo Estimado" step="0.01"/></div>
        <div class="col"><input class="form-control" id="status" placeholder="Status"/></div>
        <div class="col"><button class="btn btn-success w-100" type="submit">Salvar</button></div>
      </div>
    </form>
    <div id="outputTratamentos" class="json-output mt-3">Carregando...</div>
    <div class="tabela-scroll-wrapper">
      <table class="json-output-table mt-3" id="tabelaTratamentos" style="display:none;">
      </table>
    </div>
  </div></div>

  <!-- Incentivos -->
  <div class="card"><div class="card-body">
    <h3 class="card-title">Cadastrar Incentivo</h3>
    <form id="formIncentivo">
      <div class="row g-2 mb-2">
        <div class="col"><input class="form-control" id="tituloIncentivo" placeholder="Título"/></div>
        <div class="col"><input class="form-control" id="descricaoIncentivo" placeholder="Descrição"/></div>
        <div class="col"><input class="form-control" id="pontosRecompensa" type="number" placeholder="Pontos de Recompensa"/></div>
        <div class="col"><select class="form-select" id="ativo">
          <option value="true">Ativo</option>
          <option value="false">Inativo</option>
        </select></div>
      </div>
      <div class="row g-2 mb-2">
        <div class="col"><input class="form-control" id="data_inicio_incentivo" type="date" placeholder="Data de Início"/></div>
        <div class="col"><input class="form-control" id="data_fim_incentivo" type="date" placeholder="Data de Fim"/></div>
        <div class="col"><button class="btn btn-success w-100" type="submit">Salvar</button></div>
      </div>
    </form>
    <div id="outputIncentivos" class="json-output mt-3">Carregando...</div>
    <div class="tabela-scroll-wrapper">
      <table class="json-output-table mt-3" id="tabelaIncentivos" style="display:none;">
      </table>
    </div>
  </div></div>

  <!-- Gamificação -->
  <div class="card"><div class="card-body">
    <h3 class="card-title">Cadastrar Dados de Gamificação</h3>
    <form id="formGamificacao">
      <div class="row g-2 mb-2">
        <div class="col"><input class="form-control" id="pacienteGamificacao" placeholder="ID Paciente"/></div>
        <div class="col"><input class="form-control" id="desafio" placeholder="Desafio"/></div>
        <div class="col"><select class="form-select" id="concluido">
          <option value="false">Não Concluído</option>
          <option value="true">Concluído</option>
        </select></div>
        <div class="col"><input class="form-control" id="pontos_ganhos" type="number" placeholder="Pontos Ganhos"/></div>
        <div class="col"><input class="form-control" id="data_conclusao" type="date" placeholder="Data de Conclusão"/></div>
        <div class="col"><button class="btn btn-success w-100" type="submit">Salvar</button></div>
      </div>
    </form>
    <div id="outputGamificacao" class="json-output mt-3">Carregando...</div>
    <div class="tabela-scroll-wrapper">
      <table class="json-output-table mt-3" id="tabelaGamificacao" style="display:none;">
      </table>
    </div>
  </div></div>

  <!-- Documentos -->
  <div class="card"><div class="card-body">
    <h3 class="card-title">Cadastrar Documentos do Paciente</h3>
    <form id="formDocumento">
      <div class="row g-2 mb-2">
        <div class="col"><input class="form-control" id="pacienteDocumento" placeholder="ID Paciente"/></div>
        <div class="col"><input class="form-control" id="tipo_documento" placeholder="Tipo de Documento"/></div>
        <div class="col"><input class="form-control" id="url_arquivo" placeholder="URL do Arquivo"/></div>
        <div class="col"><input class="form-control" id="descricaoDocumento" placeholder="Descrição"/></div>
        <div class="col"><input class="form-control" id="data_upload" type="date" placeholder="Data de Upload"/></div>
        <div class="col"><button class="btn btn-success w-100" type="submit">Salvar</button></div>
      </div>
    </form>
    <div id="outputDocumentos" class="json-output mt-3">Carregando...</div>
    <div class="tabela-scroll-wrapper">
      <table class="json-output-table mt-3" id="tabelaDocumentos" style="display:none;">
      </table>
    </div>
  </div></div>
</div>
<script src="/public/main.js"></script>
<script>
  // Inicializa DataTables em todas as tabelas após carregamento dos dados
  function aplicarDataTables() {
    $(function() {
      [
        '#tabelaPacientes',
        '#tabelaConsultas',
        '#tabelaTratamentos',
        '#tabelaIncentivos',
        '#tabelaGamificacao',
        '#tabelaDocumentos'
      ].forEach(function(id) {
        if ($(id).length && !$.fn.dataTable.isDataTable(id)) {
          let table = $(id).DataTable({
            language: {
              url: 'https://cdn.datatables.net/plug-ins/1.13.7/i18n/pt-BR.json'
            },
            dom: "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
                 "<'row'<'col-sm-12'tr>>" +
                 "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
            scrollX: true,
            scrollCollapse: true,
            paging: true,
            searching: true,
            info: true,
            ordering: true,
            autoWidth: false,
            pageLength: 10,
            lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "Todos"]],
            columnDefs: [
              {
                targets: '_all',
                render: function(data, type, row) {
                  if (type === 'display' && data != null) {
                    let str = data.toString();
                    if (str.length > 50) {
                      return '<span class="long-content" title="' + str + '">' + 
                             str.substr(0, 50) + '...</span>';
                    }
                    return str;
                  }
                  return data;
                }
              },
              {
                targets: -1, // Última coluna (Ações)
                orderable: false,
                className: 'text-center'
              }
            ],
            drawCallback: function() {
              // Adiciona tooltips para conteúdo longo
              $('.long-content').on('click', function() {
                alert($(this).attr('title'));
              });
            }
          });
        }
      });
    });
  }
</script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>
</body>
</html>
